image: golang:1.18

stages:
  - build

build:
  stage: build
  script:
    - make build

unit-test:
  stage: build
  needs: [build]
  script:
    - make test

integration-test:
  stage: build
  needs: [build]
  services: 
    - postgres:latest
  variables:
      POSTGRES_USER: test_user
      POSTGRES_PASSWORD: test_password
      POSTGRES_DB: book_service
  script:
    - ./migrate.sh
    - make integration-test